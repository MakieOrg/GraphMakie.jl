<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Makie Scene tree ¬∑ GraphMakie.jl</title><meta name="title" content="Makie Scene tree ¬∑ GraphMakie.jl"/><meta property="og:title" content="Makie Scene tree ¬∑ GraphMakie.jl"/><meta property="twitter:title" content="Makie Scene tree ¬∑ GraphMakie.jl"/><meta name="description" content="Documentation for GraphMakie.jl."/><meta property="og:description" content="Documentation for GraphMakie.jl."/><meta property="twitter:description" content="Documentation for GraphMakie.jl."/><meta property="og:url" content="https://graph.makie.org/generated/scenegraph/"/><meta property="twitter:url" content="https://graph.makie.org/generated/scenegraph/"/><link rel="canonical" href="https://graph.makie.org/generated/scenegraph/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GraphMakie.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../plots/">Feature Walkthrough</a></li><li><a class="tocitem" href="../interactions/">Interaction Examples</a></li><li><a class="tocitem" href="../depgraph/">Dependency Graph</a></li><li><a class="tocitem" href="../truss/">Stress on Truss</a></li><li><a class="tocitem" href="../syntaxtree/">Julia AST</a></li><li class="is-active"><a class="tocitem" href>Makie Scene tree</a><ul class="internal"><li><a class="tocitem" href="#Extracting-the-scene-graph"><span>Extracting the scene graph</span></a></li><li><a class="tocitem" href="#Creating-the-plot"><span>Creating the plot</span></a></li></ul></li><li><a class="tocitem" href="../decisiontree/">Decision Tree</a></li><li><a class="tocitem" href="../reftests/">Reference Tests</a></li></ul></li><li><a class="tocitem" href="../../networklayout_forward/">üîó Layouts (<code>NetworkLayout.jl</code>)</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Makie Scene tree</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Makie Scene tree</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MakieOrg/GraphMakie.jl/blob/master/docs/examples/scenegraph.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Scene-graph-in-Makie"><a class="docs-heading-anchor" href="#Scene-graph-in-Makie">Scene graph in Makie</a><a id="Scene-graph-in-Makie-1"></a><a class="docs-heading-anchor-permalink" href="#Scene-graph-in-Makie" title="Permalink"></a></h1><p>In Makie, plots and scenes are stored as a tree.  Scenes can hold child Scenes and Plots, and plots can hold other plots.</p><p>In this example, we create a simple plot (<code>streamplot</code>) and render the scene graph for it.</p><pre><code class="language-julia hljs">using CairoMakie
using GraphMakie
using Graphs</code></pre><h2 id="Extracting-the-scene-graph"><a class="docs-heading-anchor" href="#Extracting-the-scene-graph">Extracting the scene graph</a><a id="Extracting-the-scene-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-the-scene-graph" title="Permalink"></a></h2><p>First, we extract the scene graph by &quot;walking&quot; down the tree.  This uses multiple dispatch to dispatch based on scenes and plots. Scenes and Plots can both hold plots, and the leaf nodes can be either Scenes with no plots (empty Scenes) or atomic plots, i.e., plots which can be rendered directly by the backend.</p><p>This function simply initializes the graph and labels, and begins the traversal.</p><pre><code class="language-julia hljs">function walk_tree(scene)
    g = SimpleDiGraph()
    labels = Any[]
    walk_tree!(g, labels, scene)
    return (g, labels)
end</code></pre><p>Now, we can walk down the Scene tree.  Scenes can have child Scenes as well as child Plots, but in terms of semantic order we walk down the Scene tree before looking at the Scene&#39;s attached plots.</p><pre><code class="language-julia hljs">function walk_tree!(g, labels, scene::Scene)
    add_vertex!(g)
    top_vertex = vertices(g)[end]

    push!(labels, label_str(scene))

    for child_scene in scene.children
        child = walk_tree!(g, labels, child_scene)
        add_edge!(g, top_vertex, child)
    end

    for child_plot in scene.plots
        child = walk_tree!(g, labels, child_plot)
        add_edge!(g, top_vertex, child)
    end

    return top_vertex
end

function walk_tree!(g, labels, plot)
    add_vertex!(g)
    top_vertex = vertices(g)[end]

    push!(labels, label_str(plot))

    for child_plot in plot.plots
        child = walk_tree!(g, labels, child_plot)
        add_edge!(g, top_vertex, child)
    end

    return top_vertex
end

# This is a utility function for the label, to avoid
# the cruft that comes from excessive type printing.
label_str(::Scene) = &quot;Scene&quot;
label_str(::Plot{F}) where {F} = string(F) # get only the plot func, not the argument type</code></pre><h2 id="Creating-the-plot"><a class="docs-heading-anchor" href="#Creating-the-plot">Creating the plot</a><a id="Creating-the-plot-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-the-plot" title="Permalink"></a></h2><p>This is a simple streamplot in an LScene, which has the simplest axis (Axis3 is more complex!)</p><pre><code class="language-julia hljs">fig, ax, plt = streamplot(-2..2, -2..2; axis = (type = LScene,),) do x::Point2
    Point2(x[2], 4x[1])
end</code></pre><img src="0ea04a92.svg" alt="Example block output"/><p>Let&#39;s walk down the tree with our previous <code>walk_tree</code> function:</p><pre><code class="language-julia hljs">newg, newl = walk_tree(fig.scene)
# This is for convenience later:
nlabels_align = [(:left, :center) for v in vertices(newg)]</code></pre><p>We start out by plotting the graph itself.</p><pre><code class="language-julia hljs">f, a, p = graphplot(
    newg;
    layout=GraphMakie.Buchheim(),
    nlabels=newl,
    nlabels_distance=10,
    nlabels_fontsize=30,
    nlabels_align,
    tangents=((0,-1),(0,-1)),
    figure = (; size = (900, 600)),
    axis = (limits = (-2.5, 2, -16, 2),)
)
hidedecorations!(a); hidespines!(a)</code></pre><p>Now, we add some improvements to the labels and positions (this is fairly minor):</p><pre><code class="language-julia hljs">_nlabels = deepcopy(newl)
_nlabels[1] = &quot;Scene (root)&quot;
_nlabels[2] = &quot;Scene (lscene.blockscene)&quot;
_nlabels[3] = &quot;Scene (LScene)&quot;
p.nlabels[] = _nlabels
fig

for v in vertices(newg)
    if isempty(inneighbors(newg, v)) # root
        nlabels_align[v] = (:center,:bottom)
    elseif isempty(outneighbors(newg, v)) #leaf
        nlabels_align[v] = (:center,:top)
    else
        self = p[:node_pos][][v]
        parent = p[:node_pos][][inneighbors(newg, v)[1]]
        if self[1] &lt; parent[1] # left branch
            nlabels_align[v] = (:right,:center)
        end
    end
end
p.nlabels_align = nlabels_align</code></pre><h3 id="Final-figure"><a class="docs-heading-anchor" href="#Final-figure">Final figure</a><a id="Final-figure-1"></a><a class="docs-heading-anchor-permalink" href="#Final-figure" title="Permalink"></a></h3><pre><code class="language-julia hljs">f</code></pre><img src="5056aa79.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../syntaxtree/">¬´ Julia AST</a><a class="docs-footer-nextpage" href="../decisiontree/">Decision Tree ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 14 January 2025 01:21">Tuesday 14 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
